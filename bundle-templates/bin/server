#!/bin/bash
#
# server - Start steampipe service
#
# This script starts the steampipe service in foreground mode.
# Configuration is loaded from STEAMPIPE_CONFIG_PATH (default: /etc/steampipe).
#
# Usage:
#   ./bin/server
#
set -e

# Source common setup
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/common.sh"

echo "Starting Steampipe service..."
echo ""
show_config
echo ""

# Validate config
validate_config

# Determine listen mode
LISTEN_MODE="${STEAMPIPE_LISTEN:-network}"

echo "Starting service..."
echo "  Listen: $LISTEN_MODE"
echo "  Port: $STEAMPIPE_DATABASE_PORT"
echo ""

# Start steampipe service in foreground
exec steampipe service start \
  --database-listen="$LISTEN_MODE" \
  --database-port="$STEAMPIPE_DATABASE_PORT" \
  --foreground
