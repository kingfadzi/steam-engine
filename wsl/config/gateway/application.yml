# Gateway Service Configuration
# Environment variables override these defaults

server:
  port: ${GATEWAY_PORT:8080}

spring:
  application:
    name: gateway
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:prod}

  # Target DW PostgreSQL (fact tables destination)
  datasource:
    url: jdbc:postgresql://${DW_HOST:localhost}:${DW_PORT:5432}/${DW_DATABASE:lct_data}
    username: ${DW_USER:postgres}
    password: ${DW_PASSWORD:}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2

  batch:
    jdbc:
      initialize-schema: always
    job:
      enabled: false  # Jobs triggered via scheduler, not on startup

# Steampipe connection (source)
steampipe:
  host: ${STEAMPIPE_HOST:localhost}
  port: ${STEAMPIPE_PORT:9193}
  database: steampipe
  username: steampipe
  password: ${STEAMPIPE_PASSWORD:}

# Fact table extraction settings
fact:
  max-partitions: ${FACT_MAX_PARTITIONS:100}
  chunk-size: 50

# SonarQube (optional)
sonarqube:
  url: ${SONARQUBE_URL:}
  token: ${SONARQUBE_TOKEN:}

# Scheduling
sync:
  enabled: ${SYNC_ENABLED:true}
  cron:
    gitlab: "0 */30 * * * *"      # Every 30 minutes
    jira: "0 */30 * * * *"        # Every 30 minutes
    sonarqube: "0 0 */2 * * *"    # Every 2 hours

# Actuator endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: always

logging:
  level:
    root: INFO
    com.leanweb.gateway: ${LOG_LEVEL:INFO}
