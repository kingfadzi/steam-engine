[Unit]
Description=Steampipe SQL Service
Documentation=https://steampipe.io/docs
After=network.target local-fs.target home-fadzi-.steampipe-db-14.19.0-postgres.mount
Requires=home-fadzi-.steampipe-db-14.19.0-postgres.mount

[Service]
Type=simple
User=fadzi
Group=fadzi

Environment=STEAMPIPE_INSTALL_DIR=/home/fadzi/.steampipe
Environment=HOME=/home/fadzi
WorkingDirectory=/home/fadzi

# Create postgres socket directory as root before starting (+ prefix = run as root)
ExecStartPre=+/bin/bash -c 'mkdir -p /run/postgresql && chown fadzi:fadzi /run/postgresql'

ExecStart=/home/fadzi/.local/bin/steampipe-start.sh
ExecStop=/home/fadzi/.steampipe/steampipe/steampipe service stop

Restart=on-failure
RestartSec=10
TimeoutStartSec=120

[Install]
WantedBy=multi-user.target
